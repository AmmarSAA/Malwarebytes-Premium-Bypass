#####################################################################################################
#												#													#
# File Name: Malware-Byte-Premium-Reset.ps1 	# Output: Schedule a task that resets the			#
# Author: Ammar S.A.A 							# Malwarebytes Premium trial by changing the 		#
# Version: 1.0 									# MachineGuid registry value 						#
#												#													#
#####################################################################################################
#						https://github.com/ammarsaa/Malwarebytes-Premium-Reset						#
#####################################################################################################

# Define the task name, path, and description
$TaskName = "Malwarebytes-Premium-Reset"
$TaskPath = "\"
$TaskDescription = "A task that resets the Malwarebytes Premium trial by changing the MachineGuid registry value"

# Get the current time in HH:mm format
$CurrentTime = (Get-Date).ToString("HH:mm")

# Define the PowerShell script for the task action
$PowerShellScript = {
	New-Guid | ForEach-Object {
		Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Cryptography' -Name 'MachineGuid' -Value $_.Guid
	}
}

# Define the task action
$TaskAction = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-Command $PowerShellScript"

# Define the task triggers, which are daily at the current system time and on system start
$TaskTrigger1 = New-ScheduledTaskTrigger -Daily -At $CurrentTime
$TaskTrigger2 = New-ScheduledTaskTrigger -AtStartup

# Define the task settings, which are to run with the highest privileges and start as soon as possible if missed
$TaskSettings = New-ScheduledTaskSettingsSet -DontStopIfGoingOnBatteries -StartWhenAvailable

# Create the task object with the specified action, triggers, settings, and other properties
$Task = New-ScheduledTask -Action $TaskAction -Trigger $TaskTrigger1, $TaskTrigger2 -Settings $TaskSettings -Description $TaskDescription

# Register the task with the specified name, path, and user (system)
Register-ScheduledTask -TaskName $TaskName -TaskPath $TaskPath -User "NT AUTHORITY\SYSTEM" -InputObject $Task
